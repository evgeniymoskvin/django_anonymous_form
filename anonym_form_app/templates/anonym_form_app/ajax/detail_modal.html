<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog_change-status">
    <div class="modal-content modal-content_clearance">
        <div class="modal-header modal-header_clearance">
            <h5 class="modal-title text-24px-regular"
                style="cursor: context-menu">Детали обращения</h5>
            <div>

                <button id="change_lists" class="icon-print"
                        data-ajax-id='{{ task.id }}'
                        onclick='window.open("{% url "blank" task.id %}","Popup", "location,status,scrollbars,resizable,width=800")'></button>

                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>
        </div>

        <form id="form_send_status" method="POST" action="{% url 'details-modal' %}"
              data-ajax-url="{% url 'details-modal' %}">
            {% csrf_token %}
            <div class="modal-body modal-body_clearance">
                <div class="d-flex w-100 flex-row justify-content-start align-items-center">
                    <div class="d-flex text-20px-regular ">id:&nbsp</div>
                    <div class="d-flex text-20px-light padding-left-30 text-align-end">{{ task.id }}</div>
                </div>
                <div class="d-flex w-100 flex-row justify-content-start align-items-center">
                    <div class="d-flex text-20px-regular ">Дата поступления:&nbsp</div>
                    <div class="d-flex text-20px-light padding-left-30 text-align-end">{{ task.date_add }}</div>
                </div>
                {% if task.start_work_date %}
                    <div class="d-flex w-100 flex-row justify-content-start align-items-center">
                        <div class="d-flex text-20px-regular ">Взято в работу:&nbsp</div>
                        <div class="d-flex text-20px-light padding-left-30 text-align-end">{{ task.start_work_date }}</div>
                    </div>
                {% endif %}
                <div class="d-flex w-100 flex-row justify-content-start align-items-center">
                    <div class="d-flex text-20px-regular ">Срочность:&nbsp</div>
                    <div class="d-flex text-20px-light padding-left-30 text-align-end">{{ task.get_important_of_question_display }}</div>
                </div>
                <div class="d-flex w-100 flex-row justify-content-start align-items-center">
                    <div class="d-flex text-20px-regular ">Тип:&nbsp</div>
                    <div class="d-flex text-20px-light padding-left-30 text-align-end">{{ task.get_type_of_question_display }}</div>
                </div>
                <div class="d-flex w-100 flex-row justify-content-start align-items-center">
                    <div class="d-flex text-20px-regular ">Подразделение:&nbsp</div>
                    <div class="d-flex text-20px-light padding-left-30 text-align-end">{{ task.subdivision.subdivision_name }}</div>
                </div>
                <div class="d-flex w-100 flex-row justify-content-start align-items-center">
                    <div class="d-flex text-20px-regular ">Сообщение:&nbsp</div>
                    <div class="d-flex text-20px-light padding-left-30 text-align-end">{{ task.question }}</div>
                </div>

                <div class="d-flex w-50 flex-row justify-content-between align-items-center mt-2">
                    <div class="d-flex text-20px-regular">Статус:</div>
                    <div class="d-none" id="hidden-div-obj-info" data-ajax-change="{{ task.id }}"></div>
                    <input class="d-none" name='obj_id_for_change_status' id="obj_id_for_change_status">
                    <div class="d-flex ms-2">
                        <select class="form-select" style="min-width: 300px"
                                name="status_id"
                                id="status_id_select">
                            {% if task.status == 0 %}
                                <option value="0" selected>Отклонено</option>
                            {% else %}
                                <option value="0">Отклонено</option>
                            {% endif %}
                            {% if task.status == 1 %}
                                <option value="1" selected>Поступило</option>
                            {% else %}
                                <option value="1">Поступило</option>
                            {% endif %}
                            {% if task.status == 2 %}
                                <option value="2" selected>В работе</option>
                            {% else %}
                                <option value="2">В работе</option>
                            {% endif %}
                            {% if task.status == 3 %}
                                <option value="3" selected>Готов</option>
                            {% else %}
                                <option value="3">Готов</option>
                            {% endif %}
                        </select>
                    </div>
                </div>
                <div class="d-none w-50 flex-row justify-content-between align-items-center mt-2" id="WhyCancel">
                    {#                        <div class="d-flex text-20px-light">Причина</div>#}
                    <input type="text" class="d-flex w-100 input_text" name="WhyCancel"
                           placeholder="Причина отмены" style="padding-left: 15px; border-radius: 4px">
                </div>

            </div>

            <div class="modal-footer modal-footer_clearance justify-content-between">
                <button class="button_blue_clearance button_blue_clearance_send_file" type="submit">
                    Сохранить
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    $('#status_id_select').change(function () {
            var selectedIndex = $('#status_id_select').prop('selectedIndex');
            console.log('selectedIndex', selectedIndex)
            if (selectedIndex == 0) {
                $('#WhyCancel').removeClass('d-none')
                $('#WhyCancel').addClass('d-flex')
            } else {
                $('#WhyCancel').removeClass('d-flex')
                $('#WhyCancel').addClass('d-none')
            }
        }
    )

    $('#form_send_status').submit(function (e) {
        e.preventDefault()
        document.getElementById('obj_id_for_change_status').value = $("#hidden-div-obj-info").attr("data-ajax-change")
        var form = $(this)
        var form_url = $("#detailModalWindow").attr("data-ajax-url")
        console.log(form_url)

        $.ajax({
            type: "POST",
            url: form_url,
            data: form.serialize(),
            success: function (data) {
                $('#detailModalWindow').modal('hide');
                getDataWithFilter()
            },
            error: function () {
                $('#detailModalWindow').modal('hide');
                $('#error_modal').modal('show');

            }
        })
    })
</script>
