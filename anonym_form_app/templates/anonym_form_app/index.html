{% extends "anonym_form_app/base.html" %}

{% block title %}
    Оставить заявку
{% endblock %}


{% block content %}
    <div class="d-flex container back-search min-vh-100 w-100" style="max-width: 1000px">
        <div class="d-flex flex-column w-100">
            <div class="d-flex flex-column" id="id_title_start">
                <div class="d-flex text-48px-bold" style="margin-top: 190px">
                    Отправить заявку
                </div>
                {#            <div class="d-flex text-18px-light ье-3" style="line-height: 100%">Заявки абсолютно анонимные#}
                {#            </div>#}
            </div>
            <form method="POST" id="form-send">
                {% csrf_token %}

                <div class="d-flex flex-column justify-content-between w-100 mt-3">
                    <div class="d-flex w-100">
                        <select class="form-select w-100"
                                name="subdivision_id"
                                id="subdivision_id"
                                >
                            <option value="" selected>Ответственное подразделение (необязательно)</option>
                            {% for obj in subdivisions %}
                                <option value="{{ obj.id }}">{{ obj.subdivision_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>


                <div class="d-flex flex-column justify-content-between w-100 mt-2">
                    <div class="d-flex w-100">
                        <select class="form-select w-100"
                                name="important_of_question"
                                id="important_of_question"
                                required>
                            <option value="" selected>Срочность</option>
                            <option value="1">Низкая</option>
                            <option value="2">Средняя</option>
                            <option value="3">Высокая</option>
                        </select>
                    </div>
                </div>

                <div class="d-flex flex-column justify-content-between w-100 mt-2">
                    <div class="d-flex w-100">
                        <select class="form-select w-100"
                                name="type_of_question"
                                id="type_of_question"
                                required>
                            <option value="" selected>Тип обращения</option>
                            <option value="1">Жалоба</option>
                            <option value="2">Предложение</option>
                        </select>
                    </div>
                </div>

                <div class="d-flex flex-column justify-content-between w-100 mt-2">
                    <div class="d-flex w-100">

                <textarea class="d-flex input_text_clearance w-100" id="question_text" name="question_text"
                          placeholder="Текст обращения (максимум 5000 символов)" required></textarea>
                    </div>
                </div>

                <div class="d-flex w-100 mb-2 mt-2">
                    <button class="d-flex w-100 button_blue" type="submit">Отправить</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Модальное окно успешной отправки-->
    <div class="modal fade" id="good_send_modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog_clearance">
            <div class="modal-content modal-content_clearance" id="inside_good_modal">

            </div>
        </div>
    </div>



    <script>
        $('#form-send').submit(function (e) {
            e.preventDefault()
            let dataToSend = $('#form-send').serialize()
            $.ajax({
                type: "POST",
                data: dataToSend,
                success: function (data) {
                    $("#inside_good_modal").html(data);
                    $('#good_send_modal').modal('show');
                    console.log(data);
                    $('#form-send').trigger('reset');
                },
                error: function () {
                    $('#error_modal').modal('show');
                }
            })

        })
    </script>

{% endblock %}